<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>PyCallJLD2 and ScikitLearn.jl · PyCallJLD2.jl</title><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script><link href="../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../democards/gridtheme.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="PyCallJLD2.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">PyCallJLD2.jl</a></span></div><form class="docs-search" action="../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../../man/guide/">Guide</a></li><li><a class="tocitem" href="../../">Examples</a></li></ul></li><li><span class="tocitem">Internals</span><ul><li><a class="tocitem" href="../../../man/full-index/">Index</a></li><li><a class="tocitem" href="../../../man/dev-index/">Dev Index</a></li><li><a class="tocitem" href="../../../man/contributing/">Contributing</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>PyCallJLD2 and ScikitLearn.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>PyCallJLD2 and ScikitLearn.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/AP6YC/PyCallJLD2.jl/blob/develop/docs/examples/tutorials/scikitlearn.jl" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="scikit-learn"><a class="docs-heading-anchor" href="#scikit-learn">PyCallJLD2 and ScikitLearn.jl</a><a id="scikit-learn-1"></a><a class="docs-heading-anchor-permalink" href="#scikit-learn" title="Permalink"></a></h1><p><a href="../scikitlearn.jl"><img src="https://img.shields.io/badge/download-julia-brightgreen.svg" alt="Source code"/></a> <a href="https://nbviewer.jupyter.org/github/AP6YC/PyCallJLD2.jl/blob/gh-pages/v0.1.0/examples/tutorials/scikitlearn.ipynb"><img src="https://img.shields.io/badge/show-nbviewer-579ACA.svg" alt="notebook"/></a> <img src="https://img.shields.io/badge/julia-1.9.0-blue.svg" alt="compat"/> <a href="https://github.com/AP6YC"><img src="https://img.shields.io/badge/Author-Sasha%20Petrenko-blue" alt="Author"/></a> <img src="https://img.shields.io/date/1689897600" alt="Update time"/></p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>This demo shows how to use <code>PyCallJLD2.jl</code> to save models from <a href="https://github.com/cstjean/ScikitLearn.jl"><code>ScikitLearn.jl</code></a>. This script borrows heavily from the <a href="https://cstjean.github.io/ScikitLearn.jl/dev/man/jld/">saving models to disk</a> example in <code>ScikitLearn.jl</code> documentation to illustrate how this package can be used as a drop-in for using <code>JLD2.jl</code> instead of <code>JLD.jl</code>.</p><h2 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h2><p>First, you must have your <code>PyCall</code> environment setup in the correct way. Here, we will point to the default Python installation internal to Julia and make sure to rebuild the PyCall package to point to it</p><pre><code class="language-julia hljs">ENV[&quot;PYTHON&quot;] = &quot;&quot;
using Pkg
Pkg.build(&quot;PyCall&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">    Building Conda ─→ `~/.julia/scratchspaces/44cfe95a-1eb2-52ea-b672-e2afdf69b78f/8c86e48c0db1564a1d49548d3515ced5d604c408/build.log`
    Building PyCall → `~/.julia/scratchspaces/44cfe95a-1eb2-52ea-b672-e2afdf69b78f/43d304ac6f0354755f1d60730ece8c499980f7ba/build.log`</code></pre><p>Next, we load our dependencies. To use this package, you must load <code>PyCall</code>, <code>JLD2</code>, and <code>PyCallJLD2</code> in the context that you intend to do model saving and loading:</p><pre><code class="language-julia hljs"># Load the modules into the current context
using
    PyCall,     # for PyObjects
    JLD2,       # for saving and loading
    PyCallJLD2  # for telling JLD2 how to save and load PyObjects</code></pre><p>Because we are showing how to save and load <code>ScikitLearn.jl</code> objects, we will also load that package and other dependencies:</p><pre><code class="language-julia hljs">using
    ScikitLearn,            # for @sk_import
    ScikitLearn.Pipelines   # for Pipeline</code></pre><h2 id="Create-some-ScikitLearn.jl-PyObjects"><a class="docs-heading-anchor" href="#Create-some-ScikitLearn.jl-PyObjects">Create some <code>ScikitLearn.jl</code> <code>PyObject</code>s</a><a id="Create-some-ScikitLearn.jl-PyObjects-1"></a><a class="docs-heading-anchor-permalink" href="#Create-some-ScikitLearn.jl-PyObjects" title="Permalink"></a></h2><p>Now we use the <code>ScikitLearn.jl</code> API to load scikit-learn modules:</p><pre><code class="language-julia hljs"># Import some scikit-learn modules
@sk_import decomposition: PCA
@sk_import linear_model: LinearRegression</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">PyObject &lt;class &#39;sklearn.linear_model._base.LinearRegression&#39;&gt;</code></pre><p>We can instantiate the modules:</p><pre><code class="language-julia hljs">pca = PCA()
lm = LinearRegression()</code></pre><style>#sk-container-id-12 {color: black;}#sk-container-id-12 pre{padding: 0;}#sk-container-id-12 div.sk-toggleable {background-color: white;}#sk-container-id-12 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-12 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-12 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-12 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-12 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-12 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-12 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-12 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-12 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-12 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-12 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-12 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-12 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-12 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-12 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-12 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-12 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-12 div.sk-item {position: relative;z-index: 1;}#sk-container-id-12 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-12 div.sk-item::before, #sk-container-id-12 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-12 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-12 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-12 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-12 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-12 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-12 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-12 div.sk-label-container {text-align: center;}#sk-container-id-12 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-12 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-12" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-12" type="checkbox" checked><label for="sk-estimator-id-12" class="sk-toggleable__label sk-toggleable__label-arrow">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div><p>and make up some random training data:</p><pre><code class="language-julia hljs">X=rand(10, 3); y=rand(10);</code></pre><p>and create a pipeline from one model to another:</p><pre><code class="language-julia hljs">pip = Pipeline([(&quot;PCA&quot;, pca), (&quot;LinearRegression&quot;, lm)])</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ScikitLearn.Skcore.Pipeline(Tuple{Any, Any}[(&quot;PCA&quot;, PyObject PCA()), (&quot;LinearRegression&quot;, PyObject LinearRegression())], Any[PyObject PCA(), PyObject LinearRegression()])</code></pre><p>Just to illustrate the statefulness of the model, let us fit the pipeline to our random dataset:</p><pre><code class="language-julia hljs">fit!(pip, X, y)   # fit to some dataset</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ScikitLearn.Skcore.Pipeline(Tuple{Any, Any}[(&quot;PCA&quot;, PyObject PCA()), (&quot;LinearRegression&quot;, PyObject LinearRegression())], Any[PyObject PCA(), PyObject LinearRegression()])</code></pre><p>and see how it fares on the same data:</p><pre><code class="language-julia hljs">score_1 = score(pip, X, y)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.5082627683615425</code></pre><h2 id="Save-and-Load"><a class="docs-heading-anchor" href="#Save-and-Load">Save and Load</a><a id="Save-and-Load-1"></a><a class="docs-heading-anchor-permalink" href="#Save-and-Load" title="Permalink"></a></h2><p>Now we will save the model with the <code>JLD2.save</code> interface:</p><pre><code class="language-julia hljs"># Name the file to save and load to
model_file = &quot;models.jld2&quot;
# Save the pipeline
JLD2.save(model_file, &quot;pip&quot;, pip)</code></pre><p>And we can load the same module into another variable in this context:</p><pre><code class="language-julia hljs">pip_2 = JLD2.load(model_file, &quot;pip&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">ScikitLearn.Skcore.Pipeline(Tuple{Any, Any}[(&quot;PCA&quot;, PyObject PCA()), (&quot;LinearRegression&quot;, PyObject LinearRegression())], Any[PyObject PCA(), PyObject LinearRegression()])</code></pre><p>Finally, lets calculate the score again for the loaded model:</p><pre><code class="language-julia hljs">score_2 = score(pip_2, X, y)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.5082627683615425</code></pre><p>and verify that the score is the same as before</p><pre><code class="language-julia hljs">score_1 == score_2</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>And voila! The answers are the same because we retained the stateful information of the pipeline during saving and loading.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>When loading the object, you must be sure that the definition for the unpacked data is in the current workspace (i.e., if you change terminal sessions here, you must remember to reimport <code>@sk_import ...</code> before loading the model file).</p></div></div><p>For the sake of this script, we will clean up after ourselves and remove the model:</p><pre><code class="language-julia hljs">rm(model_file)</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/johnnychen94/DemoCards.jl">DemoCards.jl</a> and <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Monday 11 September 2023 09:44">Monday 11 September 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
